<dom-module id="oj-app">

  <template>

      <style>

          :host {
              height: 100%;
              @apply(--layout);
              @apply(--layout-vertical);
              @apply(--layout-flex);
          }

          paper-header-panel {
              height: 100%;
              @apply(--layout);
              @apply(--layout-vertical);
              @apply(--layout-flex);
              --paper-header-panel-shadow: {
                  height:     6px;
                  bottom:     -6px;
                  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.25)
                  z-index:    1000;
              };
          }

          paper-drawer-panel {
              border-right: 1px solid #ccc;
              --paper-drawer-panel-main-container: {
                  margin-left: 6px;
                  box-shadow:  0 -2px 2px  0   rgba(0, 0, 0, 0.14), 0 -1px 5px  0   rgba(0, 0, 0, 0.12), 0 -3px 1px -2px rgba(0, 0, 0, 0.2 );
              }
          }

          oj-toolbar {
          }

          :host /deep/ #mainContainer {
              background-color: white;
          }

          #notification {
              border-radius:0;
              padding-right: 60px;
              position: fixed;
              outline: none;
              z-index: 24;
              box-sizing: border-box;
          }

      </style>

    <paper-header-panel>

        <paper-toolbar>
            <oj-toolbar currentuser="{{currentUser}}" narrow="{{narrow}}" on-toggle-drawer="toggleDrawer"></oj-toolbar>
        </paper-toolbar>

        <paper-drawer-panel id="drawerPanel" drawer-width="280px" narrow="{{narrow}}">

            <oj-main-menu drawer id="mainmenu" current-user="{{currentUser}}">
            </oj-main-menu>

            <paper-header-panel main mode="scroll" class="layout flex vertical" >
                <oj-page-router id="pages" class="layout flex vertical" on-route-changed="onRouteChanged" current-user="{{currentUser}}">
                    </oj-page-router>
            </paper-header-panel>

        </paper-drawer-panel>

    </paper-header-panel>

    <paper-toast id="notification" class="capsule core-transition core-transition-bottom" role="status" touch-action="none" tabindex="-1"></paper-toast>

    <oj-current-user on-user="onUser"></oj-current-user>

  </template>

  <script>

    Polymer({

      is: 'oj-app',

      properties: {
        onRoute: { observer: 'onRouteChanged' }
      },

      listeners: {
          'notification': 'onNotification',
          'go':           'onGo',
          'go-default':   'onGoDefault',
          'review':       'onReview'
      },

      onNotification: function (event, text) {
        this.showNotification(text);
      },

      onGo: function (event, url) {
        this.$.pages.go(url);
      },

      onGoDefault: function (event) {
        this.$.pages.gotoDefault();
      },

      onReview: function (event, paper_or_id) {
        var id = paper_or_id.typed_provider_id || paper_or_id;
        var url = '/review/' + id;
        this.$.pages.go(url);
      },

      onUser: function (event, user) {
        this.currentUser = user && user.name ? user : null;
        this.$.pages.init();
      },

      onRouteChanged: function (event, detail) {
        this.$.mainmenu.routeChanged(event, detail);
      },

      showNotification: function (text) {
        console.info('Notification: ', text);
        this.set('$.notification.text', text);
        this.$.notification.show();
      },

      toggleDrawer: function () {
        this.$.drawerPanel.togglePanel();
      }

    });

  </script>

</dom-module>
